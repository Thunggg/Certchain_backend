## üåê Blockchain Certificate System ‚Äì T·ªïng quan d·ª± √°n m·ªü r·ªông

N·ªÅn t·∫£ng ph√°t h√†nh, l∆∞u tr·ªØ, x√°c th·ª±c v√† khai th√°c gi√° tr·ªã c·ªßa ch·ª©ng ch·ªâ v√† t√†i s·∫£n s·ªë tr√™n blockchain.

---

## üéØ 1) T·∫ßm nh√¨n

Blockchain Certificate System h∆∞·ªõng ƒë·∫øn: ch·ªëng gi·∫£ m·∫°o, x√°c th·ª±c nhanh, v√† t·∫°o c∆° h·ªôi kinh t·∫ø cho ng∆∞·ªùi s·ªü h·ªØu n·ªôi dung s·ªë.

---

## üöÄ 2) √ù t∆∞·ªüng c·ªët l√µi

### üîπ Giai ƒëo·∫°n MVP

- M·ªôt t·ªï ch·ª©c ph√°t h√†nh duy nh·∫•t (Issuer) t·∫°o ch·ª©ng ch·ªâ minh b·∫°ch on-chain.
- M·ªói ch·ª©ng ch·ªâ l√† NFT d·∫°ng SBT (non-transferable) g·∫Øn v·ªõi SHA‚Äë256 hash.
- File ƒë∆∞·ª£c watermark, l∆∞u tr·ªØ, mint on-chain; ng∆∞·ªùi nh·∫≠n qu√©t QR ho·∫∑c upload file ƒë·ªÉ x√°c th·ª±c.

> Hi·ªÉu ƒë∆°n gi·∫£n: ‚ÄúGoogle Drive tr√™n blockchain‚Äù ‚Äì m·ªói file c√≥ b·∫£n sao on-chain, b·∫•t bi·∫øn, ch·ª©ng minh ngu·ªìn g·ªëc v√† t√≠nh x√°c th·ª±c.

### üîπ Giai ƒëo·∫°n m·ªü r·ªông (User Upload & Leasing)

- Ng∆∞·ªùi d√πng c√≥ th·ªÉ ƒëƒÉng k√Ω quy·ªÅn s·ªü h·ªØu n·ªôi dung s·ªë (·∫£nh, t√†i li·ªáu, video, s·∫£n ph·∫©m s√°ng t·∫°o‚Ä¶).
- Mint th√†nh NFT theo chu·∫©n ERC‚Äë4907 ƒë·ªÉ cho thu√™ (leasing) quy·ªÅn s·ª≠ d·ª•ng c√≥ th·ªùi h·∫°n.
- Ng∆∞·ªùi thu√™ c√≥ quy·ªÅn truy c·∫≠p t·∫°m th·ªùi, ch·ªß s·ªü h·ªØu g·ªëc v·∫´n gi·ªØ quy·ªÅn s·ªü h·ªØu.

K·∫øt qu·∫£: m·ªü r·ªông t·ª´ ch·ª©ng ch·ªâ h·ªçc t·∫≠p ‚Üí Digital Asset Registry & Leasing Platform.

---

## üß© 3) C√¥ng ngh·ªá & Quy tr√¨nh

### Quy tr√¨nh ch√≠nh

- Upload ‚Üí Watermark ‚Üí Hash ‚Üí Upload storage ‚Üí Mint ‚Üí QR ‚Üí Verify

### Dual‚ÄëHash Strategy (chu·∫©n h√≥a)

- originalHash: SHA‚Äë256 c·ªßa file g·ªëc (tr∆∞·ªõc watermark).
- publishedHash: SHA‚Äë256 c·ªßa file ƒë√£ watermark (s·ª≠ d·ª•ng ƒë·ªÉ mint on‚Äëchain v√† x√°c th·ª±c c√¥ng khai).
- N·∫øu ng∆∞·ªùi d√πng g·ª≠i file g·ªëc, backend c√≥ th·ªÉ nh·∫≠n di·ªán qua originalHash trong DB v√† suy ra publishedHash ƒë·ªÉ ƒë·ªëi chi·∫øu on‚Äëchain.

### C√¥ng ngh·ªá

- Frontend: Next.js (QR, Upload, Verify, Dashboard)
- Backend: Express (TypeScript, Multer, Cloudinary, Ethers.js)
- Blockchain: Solidity (OpenZeppelin ERC‚Äë721, ERC‚Äë4907, SBT), Sepolia testnet
- Database: MongoDB (Mongoose) ‚Äì mapping hash ‚Üî tokenId
- Storage: Cloudinary ‚Üí IPFS (t∆∞∆°ng lai)

---

## üèóÔ∏è 4) System Architecture

### M√¥ t·∫£ pipeline

1. Client upload file ‚Üí Backend nh·∫≠n file (Multer, memory storage)
2. Backend watermark file ‚Üí t√≠nh originalHash v√† publishedHash
3. Upload artifact (ƒë√£ watermark) l√™n Cloudinary ‚Üí tr·∫£ v·ªÅ URL
4. T·∫°o metadata.json ‚Üí upload Cloudinary (ho·∫∑c IPFS trong t∆∞∆°ng lai)
5. Mint on‚Äëchain: SBT (CertificateSBT) ho·∫∑c 4907 (CreativeAsset4907)
6. L∆∞u DB: tokenId, owner, chainId, contract, originalHash, publishedHash, URLs
7. T·∫°o QR (verify URL) ‚Üí FE hi·ªÉn th·ªã
8. Verify: qu√©t QR ho·∫∑c upload file ‚Üí backend ƒë·ªëi chi·∫øu on‚Äëchain

```mermaid
flowchart LR
  A[Client Upload] --> B[Backend Watermark]
  B --> C1[(originalHash)]
  B --> C2[(publishedHash)]
  B --> D[Cloudinary: artifact]
  D --> E[Cloudinary: metadata.json]
  E --> F[Mint on-chain]
  F --> G[(MongoDB: mapping)]
  G --> H[QR URL]
  H --> I[Verify: QR/File]
  I --> J{On-chain match?}
  J --> |Yes| K[Verified]
  J --> |No| L[Rejected]
```

---

## üîå 5) API Overview

| Endpoint                  | Method | M·ª•c ƒë√≠ch                          | Body/Query ch√≠nh                                       | Tr·∫°ng th√°i      |
| ------------------------- | ------ | --------------------------------- | ------------------------------------------------------ | --------------- |
| `/api/certificate/mint`   | POST   | Mint SBT ch·ª©ng ch·ªâ                | form-data: `file`, `owner`                             | MVP (ƒë√£ c√≥)     |
| `/api/certificate/verify` | POST   | Verify b·∫±ng upload file           | form-data: `file`, body: `tokenId` (t√πy ch·ªçn)          | MVP (ƒë√£ c√≥)     |
| `/api/certificate/verify` | GET    | Verify b·∫±ng QR (tokenId)          | query: `tokenId`, `contract`, `chain`, `type?`, `sig?` | V1.1 (k·∫ø ho·∫°ch) |
| `/api/creative/lease`     | POST   | Thi·∫øt l·∫≠p user/expires (ERC‚Äë4907) | body: `tokenId`, `user`, `expires`                     | MVP (cho 4907)  |
| `/api/creative/verify`    | GET    | Tra c·ª©u th√¥ng tin 4907            | query: `tokenId`, `contract`, `chain`                  | V1.1 (k·∫ø ho·∫°ch) |

> L∆∞u √Ω: Route prefix hi·ªán t·∫°i trong backend: `app.use('/api/certificate', ...)`.

### Ph·∫£n h·ªìi m·∫´u (Verify qua QR)

```json
{
  "tokenId": "123",
  "contract": "0x906C...",
  "chain": 11155111,
  "owner": "0x1234...",
  "issuer": "FPT University",
  "hash": "0xABC...",
  "tokenURI": "https://cloudinary.com/metadata/123.json",
  "status": "verified"
}
```

---

## üóÑÔ∏è 6) Database Schema Overview

### Certificate (MVP m·ªü r·ªông)

| Tr∆∞·ªùng            | Ki·ªÉu                 | M√¥ t·∫£                                               |
| ----------------- | -------------------- | --------------------------------------------------- |
| `originalHash`    | bytes32 (hex string) | Hash file g·ªëc (pre‚Äëwatermark), index                |
| `publishedHash`   | bytes32 (hex string) | Hash file ph√°t h√†nh (post‚Äëwatermark), unique, index |
| `fileHash`        | bytes32 (hex string) | Alias c·ªßa `publishedHash` (back‚Äëcompat)             |
| `tokenId`         | string               | Token ID on‚Äëchain                                   |
| `owner`           | string               | V√≠ s·ªü h·ªØu (EOA / Account Abstraction)               |
| `contractAddress` | string               | ƒê·ªãa ch·ªâ contract                                    |
| `chainId`         | number               | Chain ID (vd 11155111)                              |
| `tokenURI`        | string               | URL metadata.json                                   |
| `fileUrl`         | string               | URL artifact ƒë√£ watermark                           |
| `metadataUrl`     | string               | URL metadata tr√™n Cloudinary/IPFS                   |
| `transactionHash` | string               | Tx hash mint                                        |
| `status`          | enum                 | minted/pending/failed                               |

### Asset (ERC‚Äë4907) ‚Äì ƒë·ªÅ xu·∫•t

| Tr∆∞·ªùng            | Ki·ªÉu    | M√¥ t·∫£                                  |
| ----------------- | ------- | -------------------------------------- |
| `fileHash`        | bytes32 | Hash artifact (t∆∞∆°ng t·ª± publishedHash) |
| `tokenId`         | string  | Token ID                               |
| `owner`           | string  | Ch·ªß s·ªü h·ªØu                             |
| `user`            | string  | Ng∆∞·ªùi ƒë∆∞·ª£c c·∫•p quy·ªÅn s·ª≠ d·ª•ng           |
| `expires`         | number  | Unix time h·∫øt h·∫°n quy·ªÅn s·ª≠ d·ª•ng        |
| `contractAddress` | string  | ƒê·ªãa ch·ªâ contract ERC‚Äë4907              |
| `chainId`         | number  | Chain ID                               |
| `tokenURI`        | string  | Metadata URL                           |

### Issuer ‚Äì ƒë·ªÅ xu·∫•t (Multi‚ÄëIssuer)

| Tr∆∞·ªùng   | Ki·ªÉu   | M√¥ t·∫£                        |
| -------- | ------ | ---------------------------- |
| `name`   | string | T√™n t·ªï ch·ª©c ph√°t h√†nh        |
| `wallet` | string | V√≠ k√Ω ph√°t h√†nh / k√Ω EIP‚Äë712 |
| `domain` | string | Ph·∫°m vi/brand cho verify URL |
| `policy` | object | Quy t·∫Øc ph√°t h√†nh & x√°c th·ª±c |

---

## üßæ 7) QR & Verification Flow

### QR Data

`https://yourdomain.com/verify?tokenId=123&contract=0x906CE80762bd747526aeccc7Bff38118bB4b7911&chain=11155111&type=sbt&sig=...`

| Tham s·ªë           | √ù nghƒ©a                 | Ghi ch√∫                    |
| ----------------- | ----------------------- | -------------------------- |
| `tokenId`         | ID ch·ª©ng ch·ªâ NFT        | L·∫•y metadata / verify hash |
| `contract`        | ƒê·ªãa ch·ªâ contract        | Ph√¢n bi·ªát SBT / 4907       |
| `chain`           | Chain ID (vd 11155111)  | Cross‚Äëchain verify         |
| `type` (t√πy ch·ªçn) | Lo·∫°i token (sbt/4907)   | ƒêi·ªÅu ch·ªânh UI/ABI          |
| `sig` (t√πy ch·ªçn)  | Ch·ªØ k√Ω Issuer (EIP‚Äë712) | Ch·ªëng gi·∫£ m·∫°o URL          |

### Lu·ªìng x√°c th·ª±c

- QR ‚Üí FE m·ªü `/verify?...` ‚Üí FE g·ªçi BE: `GET /api/certificate/verify?...`
- BE ƒë·ªçc `tokenId/contract/chain/type` ‚Üí ƒë·ªçc `ownerOf`, `tokenURI` ‚Üí (n·∫øu c√≥ file) ƒë·ªëi chi·∫øu `verifyHash(tokenId, publishedHash)` tr√™n contract.

---

## üîê 8) Security & Validation Rules

- **Access control**:
  - SBT/4907 mint: `onlyOwner` tr√™n contract.
  - 4907 `setUser`: ch·ªâ ch·ªß s·ªü h·ªØu ƒë∆∞·ª£c ph√©p.
- **Input validation**: MIME whitelist, gi·ªõi h·∫°n k√≠ch th∆∞·ªõc, Express‚ÄëValidator cho params.
- **Hashing strategy**: Dual‚Äëhash (original/published). On‚Äëchain d√πng `publishedHash`.
- **Double‚Äëmint prevention**:
  - Cloudinary: ki·ªÉm tra t·ªìn t·∫°i (public_id = publishedHash) ‚Üí 409 Conflict.
  - DB: `publishedHash` unique; `fileHash` alias gi·ªØ back‚Äëcompat.
- **Rate limiting & abuse**: ƒê·ªÅ xu·∫•t s·ª≠ d·ª•ng `express-rate-limit`, captcha cho public verify API n·∫øu c·∫ßn.
- **Replay & tampering**: Verify URL c√≥ `sig` (EIP‚Äë712) t·ª´ Issuer (t√πy ch·ªçn). L∆∞u `chainId`/`contractAddress` ƒë·ªÉ ch·ªëng nh·∫ßm l·∫´n.
- **Privacy**: Kh√¥ng l∆∞u file g·ªëc; ch·ªâ l∆∞u artifact ƒë√£ watermark v√† metadata c√¥ng khai.

---

## üß™ 9) Environment Setup & Run Instructions

### Y√™u c·∫ßu

- Node.js >= 18
- MongoDB (Atlas ho·∫∑c self‚Äëhosted)
- Cloudinary account

### Bi·∫øn m√¥i tr∆∞·ªùng (`.env`)

```bash
PORT=3000

# Database
DB_NAME=your_db
DB_PASSWORD=your_password

# Blockchain
RPC_URL=https://sepolia.infura.io/v3/xxx
PRIVATE_KEY=0xabc...
CHAIN_ID=11155111
CERTIFICATE_CONTRACT_ADDRESS=0xYourSBT
CREATIVE4907_CONTRACT_ADDRESS=0xYour4907   # n·∫øu d√πng

# Cloudinary
CLOUDINARY_CLOUD_NAME=xxx
CLOUDINARY_API_KEY=xxx
CLOUDINARY_API_SECRET=xxx

# Verify
VERIFY_BASE_URL=https://yourdomain.com/verify
```

### C√†i ƒë·∫∑t & ch·∫°y

```bash
npm install
npm run dev  # ho·∫∑c: npm run start
```

---

## üó∫Ô∏è 10) Roadmap & Future Expansion

### V1.0 (MVP)

- SBT issuing & verify (upload file / QR tokenId)
- Dual‚Äëhash storage (original/published)
- Cloudinary storage, MongoDB mapping

### V1.1

- GET verify by tokenId/contract/chain
- QR image generation & deep link
- ERC‚Äë4907 verify endpoints

### V2.0 (B2B)

- Multi‚ÄëIssuer (t√°ch b·∫£ng `Issuer`, policy per issuer)
- IPFS/Filecoin storage (ipfs:// metadata & files)
- Attestation & Signature (EIP‚Äë712/JWS)

### V3.0 (C2C & Marketplace)

- Leasing marketplace (ERC‚Äë4907) + fee model
- Webhook & public API for third‚Äëparties (HR/LMS)
- Reputation system

### V4.0 (Web3 Economy)

- Cross‚Äëchain support (BNB, Polygon, Linea, Base...)
- Tokenomics (optional) ‚Äì mint/verify/reward

---

## ü§ù 11) AI Collaboration Note

- M·ª•c ti√™u: gi·ªØ cho ki·∫øn tr√∫c modul h√≥a, m·ªü r·ªông, v√† an to√†n (best practices Starknet/EVM & Cairo/Solidity).
- ∆Øu ti√™n: t√°ch interface r√µ r√†ng (ABI, storage layout), ph√°t h√†nh nhi·ªÅu phi√™n b·∫£n an to√†n, v√† test coverage cao.
- Khi m·ªü r·ªông: h√£y tu√¢n th·ªß chi·∫øn l∆∞·ª£c dual‚Äëhash, chu·∫©n metadata, event emission ƒë·∫ßy ƒë·ªß ƒë·ªÉ ph·ª•c v·ª• indexing.
- G·ª£i √Ω AI: c√≥ th·ªÉ t·ª± ƒë·ªông sinh route/ABI mapping, migration DB, v√† CI/CD (compile, test, deploy, version h√≥a class hash/bytecode).

---

## üí° 12) Gi√° tr·ªã c·ªët l√µi

| Gi√° tr·ªã               | Gi·∫£i th√≠ch                                          |
| --------------------- | --------------------------------------------------- |
| **Minh b·∫°ch**         | Hash, issuer, metadata c√¥ng khai on‚Äëchain           |
| **Kh√¥ng th·ªÉ gi·∫£ m·∫°o** | File ƒë∆∞·ª£c watermark r·ªìi hash SHA‚Äë256                |
| **X√°c th·ª±c nhanh**    | QR ho·∫∑c upload file ‚Üí ki·ªÉm tra on‚Äëchain t·ª©c th√¨     |
| **T·ª± ch·ªß s·ªü h·ªØu**     | Ng∆∞·ªùi d√πng t·ª± qu·∫£n l√Ω, ƒëƒÉng k√Ω, cho thu√™ t√†i s·∫£n s·ªë |
| **M·ªü r·ªông linh ho·∫°t** | T·ª´ ch·ª©ng ch·ªâ ‚Üí t√°c ph·∫©m s√°ng t·∫°o ‚Üí t√†i s·∫£n tr√≠ tu·ªá  |

---

## üîÆ 13) T∆∞∆°ng lai xa h∆°n

- DAO Governance: c·ªông ƒë·ªìng issuer/verifier qu·∫£n l√Ω whitelist & ti√™u chu·∫©n metadata.
- AI Verification: ph√°t hi·ªán file gi·∫£ m·∫°o qua ph√¢n t√≠ch h√¨nh ·∫£nh + hash.
- LMS/HRM Integration: t·ª± ƒë·ªông c·∫•p ch·ª©ng ch·ªâ sau khi ho√†n th√†nh kh√≥a h·ªçc/k·ª≥ thi.
- Decentralized Audit Logs: l∆∞u l·ªãch s·ª≠ verify tr√™n chu·ªói.

R·∫•t hay ‚Äî t√†i li·ªáu b·∫°n vi·∫øt th·ª±c ra ƒë√£ r·∫•t g·∫ßn v·ªõi m·ªôt Business Requirement Specification (BRS) ho√†n ch·ªânh.
D∆∞·ªõi ƒë√¢y l√† ph·∫ßn ph√¢n t√≠ch business rule (quy t·∫Øc nghi·ªáp v·ª•) ƒë∆∞·ª£c tr√≠ch ra v√† di·ªÖn gi·∫£i t·ª´ to√†n b·ªô thi·∫øt k·∫ø c·ªßa b·∫°n, chia th√†nh c√°c l·ªõp: Actor ‚Üí Process ‚Üí Constraint ‚Üí Validation ‚Üí Compliance ‚Üí Monetization.

üß© I. Actors & Roles
Vai tr√≤ Quy·ªÅn h·∫°n ch√≠nh M·ª•c ti√™u nghi·ªáp v·ª•
Issuer (T·ªï ch·ª©c ph√°t h√†nh) Upload file, watermark, mint SBT, k√Ω x√°c th·ª±c (EIP-712) C·∫•p ch·ª©ng ch·ªâ, ƒë·∫£m b·∫£o t√≠nh x√°c th·ª±c
User (Ng∆∞·ªùi d√πng cu·ªëi) Upload n·ªôi dung, ƒëƒÉng k√Ω s·ªü h·ªØu, mint ERC-4907 ƒêƒÉng k√Ω & cho thu√™ t√†i s·∫£n s√°ng t·∫°o
Verifier (B√™n x√°c th·ª±c) Qu√©t QR ho·∫∑c upload file ƒë·ªÉ ki·ªÉm ch·ª©ng Ki·ªÉm tra t√≠nh h·ª£p l·ªá c·ªßa ch·ª©ng ch·ªâ ho·∫∑c file
System (Backend) T·ª± ƒë·ªông h√≥a hash, l∆∞u tr·ªØ, mint, verify, watermark, log ƒê·∫£m b·∫£o pipeline ƒë√∫ng v√† minh b·∫°ch
